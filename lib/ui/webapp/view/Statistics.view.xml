<mvc:View
  controllerName="sap.audit.controller.Statistics"
  xmlns="sap.m"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns:viz="sap.viz.ui5.controls"
  xmlns:layout="sap.ui.layout"
  xmlns:viz.data="sap.viz.ui5.data"
  xmlns:viz.feeds="sap.viz.ui5.controls.common.feeds">
  
  <Page
    title="{i18n>statisticsTitle}"
    showNavButton="true"
    navButtonPress=".onNavBack">
    
    <content>
      <VBox class="sapUiContentPadding">
        <HBox justifyContent="SpaceBetween" class="sapUiSmallMarginBottom">
          <VBox>
            <Label text="{i18n>dateRangeLabel}" />
            <DateRangeSelection
              id="dateFilter"
              change=".onDateRangeChange" />
          </VBox>
          
          <VBox>
            <Label text="{i18n>entityLabel}" />
            <ComboBox
              id="entityFilter"
              items="{
                path: '/EntityTypes'
              }">
              <core:Item key="{Name}" text="{Name}" />
            </ComboBox>
          </VBox>
          
          <VBox>
            <Button 
              text="{i18n>applyFiltersButton}" 
              type="Emphasized" 
              press=".onApplyFilters"
              class="sapUiSmallMarginTop" />
          </VBox>
        </HBox>
        
        <Panel headerText="{i18n>operationStatisticsTitle}" expandable="true" expanded="true">
          <viz:VizFrame
            id="operationChart"
            height="400px"
            width="100%"
            vizType="pie">
            <viz:dataset>
              <viz.data:FlattenedDataset data="{statistics>/operations}">
                <viz.data:dimensions>
                  <viz.data:DimensionDefinition name="Operation" value="{statistics>operation}" />
                </viz.data:dimensions>
                <viz.data:measures>
                  <viz.data:MeasureDefinition name="Count" value="{statistics>count}" />
                </viz.data:measures>
              </viz.data:FlattenedDataset>
            </viz:dataset>
            <viz:feeds>
              <viz.feeds:FeedItem uid="size" type="Measure" values="Count" />
              <viz.feeds:FeedItem uid="color" type="Dimension" values="Operation" />
            </viz:feeds>
          </viz:VizFrame>
        </Panel>
        
        <Panel headerText="{i18n>entityStatisticsTitle}" expandable="true" expanded="true">
          <viz:VizFrame
            id="entityChart"
            height="400px"
            width="100%"
            vizType="column">
            <viz:dataset>
              <viz.data:FlattenedDataset data="{statistics>/entities}">
                <viz.data:dimensions>
                  <viz.data:DimensionDefinition name="Entity" value="{statistics>entity}" />
                </viz.data:dimensions>
                <viz.data:measures>
                  <viz.data:MeasureDefinition name="Count" value="{statistics>count}" />
                </viz.data:measures>
              </viz.data:FlattenedDataset>
            </viz:dataset>
            <viz:feeds>
              <viz.feeds:FeedItem uid="valueAxis" type="Measure" values="Count" />
              <viz.feeds:FeedItem uid="categoryAxis" type="Dimension" values="Entity" />
            </viz:feeds>
          </viz:VizFrame>
        </Panel>
        
        <Panel headerText="{i18n>detailedStatisticsTitle}" expandable="true" expanded="true">
          <Table
            id="statsTable"
            items="{statistics>/details}"
            fixedLayout="false">
            <columns>
              <Column>
                <Text text="{i18n>entityColumn}" />
              </Column>
              <Column>
                <Text text="{i18n>operationColumn}" />
              </Column>
              <Column hAlign="End">
                <Text text="{i18n>countColumn}" />
              </Column>
              <Column hAlign="End">
                <Text text="{i18n>percentageColumn}" />
              </Column>
            </columns>
            <items>
              <ColumnListItem>
                <cells>
                  <Text text="{statistics>entity}" />
                  <Text text="{statistics>operation}" />
                  <Text text="{statistics>count}" />
                  <Text text="{
                    path: 'statistics>percentage',
                    formatter: '.formatter.formatPercentage'
                  }" />
                </cells>
              </ColumnListItem>
            </items>
          </Table>
        </Panel>
      </VBox>
    </content>
  </Page>
</mvc:View> 