<mvc:View
  controllerName="sap.audit.controller.Main"
  xmlns="sap.m"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns:f="sap.f"
  xmlns:core="sap.ui.core">
  
  <Page
    title="{i18n>auditLogsTitle}"
    showNavButton="false">
    <headerContent>
      <Button
        icon="sap-icon://bar-chart"
        tooltip="{i18n>statisticsTooltip}"
        press=".onShowStatistics" />
    </headerContent>
    
    <f:DynamicPage id="dynamicPageId" headerExpanded="{/headerExpanded}">
      <f:title>
        <f:DynamicPageTitle>
          <f:heading>
            <Title text="{i18n>auditLogsTitle}" />
          </f:heading>
          <f:actions>
            <Button 
              text="{i18n>filterButton}" 
              type="Emphasized" 
              press=".onToggleFilter" />
          </f:actions>
        </f:DynamicPageTitle>
      </f:title>
      
      <f:header>
        <f:DynamicPageHeader pinnable="true">
          <FlexBox alignItems="Start" justifyContent="SpaceBetween">
            <items>
              <VBox>
                <Label text="{i18n>entityLabel}" />
                <ComboBox
                  id="entityFilter"
                  items="{
                    path: '/EntityTypes'
                  }">
                  <core:Item key="{Name}" text="{Name}" />
                </ComboBox>
              </VBox>
              
              <VBox>
                <Label text="{i18n>operationLabel}" />
                <MultiComboBox
                  id="operationFilter"
                  items="{
                    path: '/Operations'
                  }">
                  <core:Item key="{Name}" text="{Name}" />
                </MultiComboBox>
              </VBox>
              
              <VBox>
                <Label text="{i18n>dateRangeLabel}" />
                <DateRangeSelection
                  id="dateFilter"
                  change=".onDateRangeChange" />
              </VBox>
              
              <VBox>
                <Label text="{i18n>userLabel}" />
                <Input id="userFilter" />
              </VBox>
              
              <VBox>
                <Button 
                  text="{i18n>applyFiltersButton}" 
                  type="Emphasized" 
                  press=".onApplyFilters" />
                <Button 
                  text="{i18n>resetFiltersButton}" 
                  press=".onResetFilters" 
                  class="sapUiTinyMarginTop" />
              </VBox>
            </items>
          </FlexBox>
        </f:DynamicPageHeader>
      </f:header>
      
      <f:content>
        <Table
          id="auditLogsTable"
          items="{
            path: '/Logs',
            parameters: {
              $count: true
            }
          }"
          growing="true"
          growingThreshold="20"
          growingScrollToLoad="true">
          <columns>
            <Column>
              <Text text="{i18n>timestampColumn}" />
            </Column>
            <Column>
              <Text text="{i18n>userColumn}" />
            </Column>
            <Column>
              <Text text="{i18n>operationColumn}" />
            </Column>
            <Column>
              <Text text="{i18n>entityColumn}" />
            </Column>
            <Column>
              <Text text="{i18n>statusColumn}" />
            </Column>
            <Column hAlign="End">
              <Text text="{i18n>actionsColumn}" />
            </Column>
          </columns>
          <items>
            <ColumnListItem type="Navigation" press=".onItemPress">
              <cells>
                <Text text="{
                  path: 'timestamp',
                  formatter: '.formatter.formatDateTime'
                }" />
                <Text text="{user}" />
                <Text text="{operation}" />
                <Text text="{entity}" />
                <ObjectStatus
                  text="{= ${success} ? ${i18n>successStatus} : ${i18n>failureStatus} }"
                  state="{= ${success} ? 'Success' : 'Error' }" />
                <Button
                  icon="sap-icon://display"
                  press=".onViewDetails"
                  tooltip="{i18n>viewDetailsTooltip}" />
              </cells>
            </ColumnListItem>
          </items>
        </Table>
      </f:content>
    </f:DynamicPage>
  </Page>
</mvc:View> 